


# 8. Service Cores

DPDK 有一个称为服务核心的概念，它支持在 DPDK lcore 上执行工作的动态方式。服务核心支持内置于 EAL 中，并提供 API 来允许应用程序选择性地控制服务核心在运行时的使用方式。

服务核心概念是由服务（需要 CPU 周期才能运行的 DPDK 组件）和服务核心（DPDK lcore，负责运行服务）构建的。服务核心概念的强大之处在于，可以配置服务核心和服务之间的映射，以抽象出平台和环境之间的差异。

例如，Eventdev 有硬件和软件 PMD。其中，软件PMD需要lcore来执行调度操作，而硬件PMD则不需要。使用服务核心，应用程序不会直接注意到调度是在软件中完成的。

有关服务核心API的详细信息，请参阅文档。

## 8.1.服务核心初始化

有两种方法可以在 DPDK 应用程序中使用服务核心：使用服务核心掩码，或使用 API 动态添加核心。两者中更简单的方法是将 -s coremask 参数传递给 EAL，这将采用主 DPDK coremask 中可用的任何核心，如果这些位也在服务 coremask 中设置，则核心将成为服务核心而不是 DPDK 应用程序 lcore 。

## 8.2.在核心上启用服务

每个注册的服务可以单独映射到一个服务核心或一组服务核心。在特定核心上启用服务意味着相关 lcore 将运行该服务。禁用服务上的该核心会阻止相关 lcore 运行该服务。

使用这种方法，可以为每个服务核心分配特定的工作负载，并将N个工作负载映射到M个服务核心。每个服务 lcore 都会循环访问为该核心启用的服务，并调用该函数来运行该服务。

## 8.3.服务核心统计

服务核心库使用 DPDK 跟踪库通过跟踪点进行检测。这些跟踪点允许您跟踪服务和逻辑核心状态。要在启动 DPDK 程序时激活跟踪，需要使用 --trace 选项指定正则表达式来选择要启用的跟踪点。如果您只想指定服务核心跟踪，下面是一个示例：

```c
./dpdk/examples/service_cores/build/service_cores --trace="lib.eal.thread*" --trace="lib.eal.service*"
```

有关详细信息，请参阅[跟踪库](https://doc.dpdk.org/guides/prog_guide/trace_lib.html)文档。

